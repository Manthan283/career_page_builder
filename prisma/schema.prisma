generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id          String          @id @default(uuid())
  slug        String          @unique
  name        String
  heroText    String?
  description String?
  website     String?
  branding    Json?
  settings    Json?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  jobs        Job[]
  users       User[]
  members     CompanyMember[]
  invites     CompanyInvite[]
}

model Job {
  id               String    @id @default(uuid())
  company          Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId        String
  title            String
  slug             String
  location         String?
  jobType          String?
  description      String
  responsibilities Json?
  qualifications   Json?
  isPublished      Boolean   @default(true)
  postedAt         DateTime  @default(now())
  expiresAt        DateTime?
  metadata         Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@unique([companyId, slug])
  @@index([companyId, title])
}

model User {
  id          String          @id @default(uuid())
  email       String          @unique
  name        String?
  password    String?
  role        String          @default("admin")
  company     Company         @relation(fields: [companyId], references: [id])
  companyId   String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  memberships CompanyMember[]
  invitesSent CompanyInvite[]
}

enum CompanyRole {
  OWNER
  ADMIN
  EDITOR
  VIEWER
}

model CompanyMember {
  id String @id @default(uuid())

  userId    String
  companyId String
  role      CompanyRole

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([userId])
}

model CompanyInvite {
  id          String      @id @default(uuid())
  email       String
  role        CompanyRole
  token       String      @unique
  company     Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   String
  invitedBy   User        @relation(fields: [invitedById], references: [id])
  invitedById String
  accepted    Boolean     @default(false)
  createdAt   DateTime    @default(now())
  expiresAt   DateTime
}
